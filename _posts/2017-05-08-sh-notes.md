---
layout: post
title:  "sh notes"
date:   2017-05-08 18:36:46 +0900
categories: sh
---


## replace word/contents in txt/script file

```sh
main.sh
-------
$ cat main.sh

read l_zipfile
script=$(sed -e "s|\${r_zipfile}|$l_zipfile|"  file.sh)
echo $script

file.sh
-------
$ cat file.sh
echo ${r_zipfile}

$ ./main.sh
fgh
echo fgh
```

## iconv

```sh
$ echo |zo | iconv -f UTF8 -t ASCII//TRANSLIT
azzco
```

## help notes on "find"
```sh
# $() in this way is that the subshell executes prior to 
#executing the find command, and not as part of -exec.
$ find dir/ -type f -exec mv {} $(echo {} | iconv -f UTF8 -t ASCII//TRANSLIT ) \;
mv: `dir/zi' and `dir/zi' are the same file

# You can do it, but you'll need to invoke bash 
find dir/ -type f -exec bash -c 
  'mv "$1" "$(iconv -f UTF8 -t ASCII//TRANSLIT <<< $1)"' -- {} \;


#Keep in mind this will also translit any special chars 
#in directory names as well, which may cause the mv to fail. 
#If you only want to translit the filename, then you could:

find dir/ -type f -exec bash -c 
  'mv "$1" "${1%/*}/$(iconv -f UTF8 -t ASCII//TRANSLIT <<< ${1##*/})"' -- {} \;

$ find dir/ -type f | xargs -I{} echo {} | iconv -f UTF8 -t ASCII//TRANSLIT
dir/zia
```

## find line nos of grep word

```sh
$ cat abcd.txt
ithis

dsd

d
s3r


ds
$
$
$ grep -n 'ds' abcd.txt
3:dsd
9:ds
$

$ sed -n '/ds/ =' abcd.txt
3
9
$
```

## notes on find -exec
```sh

||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
    Sample dir , file structure:
||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
└─test1
    │  1.txt
    │  2.txt
    │
    └─test2
        │  11.txt
        │  22.txt
        │
        └─test3
                111.txt
                222.txt
            
    
                
-----------------------   Initial listing ................-------------
$ ls -lR test1
total 0
-rw-rw-r--    1 t24test4 t24               0 Apr 11 14:55 1.txt
-rw-rw-r--    1 t24test4 t24               0 Apr 11 14:55 2.txt
drwxrwxr-x    3 t24test4 t24             256 Apr 11 14:55 test2
test1/test2:
total 0
-rw-rw-r--    1 t24test4 t24               0 Apr 11 14:55 11.txt
-rw-rw-r--    1 t24test4 t24               0 Apr 11 14:55 22.txt
drwxrwxr-x    2 t24test4 t24             256 Apr 11 14:55 test3
test1/test2/test3:
total 0
-rw-rw-r--    1 t24test4 t24               0 Apr 11 14:55 111.txt
-rw-rw-r--    1 t24test4 t24               0 Apr 11 14:55 222.txt
|||||||||---------find only files -------------------||||||||||||||||||||||
$ find ./test1 -type f -exec ls -l {} \;
-rw-rw-r--    1 t24test4 t24               0 Apr 11 14:55 ./test1/1.txt
-rw-rw-r--    1 t24test4 t24               0 Apr 11 14:55 ./test1/2.txt
-rw-rw-r--    1 t24test4 t24               0 Apr 11 14:55 ./test1/test2/11.txt
-rw-rw-r--    1 t24test4 t24               0 Apr 11 14:55 ./test1/test2/22.txt
-rw-rw-r--    1 t24test4 t24               0 Apr 11 14:55 ./test1/test2/test3/111.txt
-rw-rw-r--    1 t24test4 t24               0 Apr 11 14:55 ./test1/test2/test3/222.txt
*************************************************************************
  delete files in dir and subdir
*************************************************************************
# be careful about :
# try to avoid the format by giving dir name "." ( the current dir ) 
# find . -type f -exec rm {} \;
# Always try giving dir name, here it is "./test1"
# find ./test1 -type f -exec rm {} \;
*************************************************************************
$ find ./test1 -type f -exec rm {} \;
*************************************************************************
|||||||||||---------- dir structure after delete ---------||||||||||||||||
└─test1
    └─test2
        └─test3
        
-----------------------   listing after find & delete......-------------
$ ls -lR test1
total 0
drwxrwxr-x    3 t24test4 t24             256 Apr 11 15:00 test2
test1/test2:
total 0
drwxrwxr-x    2 t24test4 t24             256 Apr 11 15:00 test3
test1/test2/test3:
total 0
||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||

```
